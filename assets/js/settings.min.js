jQuery(document).ready((function(e){"use strict";function t(e){e.find(".tbds-error").removeClass("tbds-error"),e.find(".tbds-error-message").html("");let t=0,s=e.find(".tbds-format-price-rules-from"),r=s.val(),a=e.find(".tbds-format-price-rules-to"),n=a.val(),l=e.find(".tbds-format-price-rules-value-from"),i=l.val(),o=e.find(".tbds-format-price-rules-value-to"),d=o.val(),c=e.find(".tbds-format-price-rules-value"),u=c.val(),m=e.find('select[name="tbds_format_price_rules[part][]"]');if(parseFloat(r)>parseFloat(n)&&(t++,s.closest(".vi-ui.labeled").addClass("tbds-error"),a.closest(".vi-ui.labeled").addClass("tbds-error"),s.closest(".tbds-error-message-parent").find(".tbds-error-message").html(tbdsParams.i18n_error_min_max),a.closest(".tbds-error-message-parent").find(".tbds-error-message").html(tbdsParams.i18n_error_max_min)),"integer"===m.val()){let e=Math.min(parseInt(r).toString().length,parseInt(n).toString().length)-1;parseFloat(i)>parseFloat(d)&&(t++,l.closest(".vi-ui.labeled").addClass("tbds-error"),o.closest(".vi-ui.labeled").addClass("tbds-error"),l.closest(".tbds-error-message-parent").find(".tbds-error-message").html(tbdsParams.i18n_error_min_max),o.closest(".tbds-error-message-parent").find(".tbds-error-message").html(tbdsParams.i18n_error_max_min)),parseInt(r).toString().length<2&&(t++,s.closest(".vi-ui.labeled").addClass("tbds-error"),s.closest(".tbds-error-message-parent").find(".tbds-error-message").html(tbdsParams.i18n_error_min_digits)),parseInt(n).toString().length<2&&(t++,a.closest(".vi-ui.labeled").addClass("tbds-error"),a.closest(".tbds-error-message-parent").find(".tbds-error-message").html(tbdsParams.i18n_error_min_digits)),(0!==parseInt(i)||0!==parseInt(d))&&e>0&&(i.length>e&&(t++,l.closest(".vi-ui.labeled").addClass("tbds-error"),l.closest(".tbds-error-message-parent").find(".tbds-error-message").html(1===e?tbdsParams.i18n_error_max_digit.replace("{value}",e):tbdsParams.i18n_error_max_digits.replace("{value}",e))),d.length>e&&(t++,o.closest(".vi-ui.labeled").addClass("tbds-error"),o.closest(".tbds-error-message-parent").find(".tbds-error-message").html(1===e?tbdsParams.i18n_error_max_digit.replace("{value}",e):tbdsParams.i18n_error_max_digits.replace("{value}",e)))),""===i&&""===d&&u.length>e&&e>0&&(t++,c.closest(".vi-ui.labeled").addClass("tbds-error"),c.closest(".tbds-error-message-parent").find(".tbds-error-message").html(1===e?tbdsParams.i18n_error_max_digit.replace("{value}",e):tbdsParams.i18n_error_max_digits.replace("{value}",e)));let m=Math.min(e,Math.max(i.length,d.length));(""!==i||""!==d)&&u.length>m&&e>0&&(t++,c.closest(".vi-ui.labeled").addClass("tbds-error"),c.closest(".tbds-error-message-parent").find(".tbds-error-message").html(1===m?tbdsParams.i18n_error_max_digit.replace("{value}",m):tbdsParams.i18n_error_max_digits.replace("{value}",m))),/^\d+$/.test(u)||(t++,c.closest(".vi-ui.labeled").addClass("tbds-error"),c.closest(".tbds-error-message-parent").find(".tbds-error-message").html(tbdsParams.i18n_error_digit_only))}else max_decimals>0&&(parseFloat(`.${i}`)>parseFloat(`.${d}`)&&(t++,l.closest(".vi-ui.labeled").addClass("tbds-error"),o.closest(".vi-ui.labeled").addClass("tbds-error"),l.closest(".tbds-error-message-parent").find(".tbds-error-message").html(tbdsParams.i18n_error_min_max),o.closest(".tbds-error-message-parent").find(".tbds-error-message").html(tbdsParams.i18n_error_max_min)),u.length>max_decimals&&(t++,c.closest(".vi-ui.labeled").addClass("tbds-error"),c.closest(".tbds-error-message-parent").find(".tbds-error-message").html(tbdsParams.i18n_error_max_decimals)),function(e){return/^[\d|x]+$/i.test(e)}(u)||(t++,c.closest(".vi-ui.labeled").addClass("tbds-error"),c.closest(".tbds-error-message-parent").find(".tbds-error-message").html(tbdsParams.i18n_error_digit_and_x_only)));return t}function s(e){let t=e.closest("tr");switch(e.val()){case"fixed":t.find(".tbds-value-label-left").html("+"),t.find(".tbds-value-label-right").html("$");break;case"percent":t.find(".tbds-value-label-left").html("+"),t.find(".tbds-value-label-right").html("%");break;case"multiply":t.find(".tbds-value-label-left").html("x"),t.find(".tbds-value-label-right").html("");break;default:t.find(".tbds-value-label-left").html("="),t.find(".tbds-value-label-right").html("$")}}function r(){let t=1;e(".tbds-format-price-rules-number").map((function(){e(this).html(t),t++}))}e(document).on("click",".vichinads-migrate-to-new-table",(function(){if(!confirm("Do you want to migrate to new table?"))return;let t=e(this);t.addClass("loading"),e.ajax({url:tbdsParams.ajaxUrl,type:"post",data:{action:"vichinads_migrate_to_new_table",_ajax_nonce:tbdsParams.security},success(e){t.text(e.data),t.removeClass("vichinads-migrate-to-new-table")},complete(){t.removeClass("loading")}})})),e(document).on("click",".vichinads-migrate-remove-old-data",(function(){if(!confirm("Do you want to remove old data from posts table?"))return;let t=e(this);t.addClass("loading"),e.ajax({url:tbdsParams.ajaxUrl,type:"post",data:{action:"vichinads_migrate_remove_old_data",_ajax_nonce:tbdsParams.security},success(e){t.text(e.data),t.removeClass("vichinads-migrate-remove-old-data")},complete(){t.removeClass("loading")}})})),e(".vi-ui.menu .item").viTab({history:!0}),e(".tbds-dropdown").viDropdown({placeholder:""}),e(".tbds-save-settings").on("click",(function(s){let r=0,a=0;return e(".tbds-price-rule-row").map((function(){r+=function(e){e.find(".tbds-error").removeClass("tbds-error");let t=0,s=e.find(".tbds-plus-sale-value"),r=e.find(".tbds-plus-value"),a=e.find(".tbds-price-from"),n=e.find(".tbds-price-to");return parseFloat(s.val())>-1&&parseFloat(s.val())>parseFloat(r.val())&&(t++,s.closest(".vi-ui.labeled").addClass("tbds-error"),r.closest(".vi-ui.labeled").addClass("tbds-error")),""!==n.val()&&parseFloat(a.val())>parseFloat(n.val())&&(t++,a.closest(".vi-ui.labeled").addClass("tbds-error"),n.closest(".vi-ui.labeled").addClass("tbds-error")),t}(e(this))})),r>0?(alert("Regular price can not be smaller than sale price"),!1):(e(".tbds-format-price-rules-container>tr").map((function(){a+=t(e(this))})),a>0?(alert("You have error(s) in your rules"),!1):void 0)})),e(".search-category").select2({width:"100%",closeOnSelect:!1,placeholder:"Please fill in your category title",ajax:{url:"admin-ajax.php?action=tbds_search_cate",dataType:"json",type:"GET",quietMillis:50,delay:250,data:e=>({keyword:e.term}),processResults:e=>({results:e}),cache:!0},escapeMarkup:function(e){return e},minimumInputLength:2}),e(".search-tags").select2({width:"100%",closeOnSelect:!1,placeholder:"Please enter tag to search",ajax:{url:"admin-ajax.php?action=tbds_search_tags",dataType:"json",type:"GET",quietMillis:50,delay:250,data:e=>({keyword:e.term}),processResults:e=>({results:e}),cache:!0},escapeMarkup:function(e){return e},minimumInputLength:2}),e(".tbds-price-rule-add").on("click",(function(){let t=e(".tbds-price-rule-row").last().clone();t.find(".tbds-price-from").val(""),t.find(".tbds-price-to").val(""),t.find(".tbds-plus-value-type").viDropdown(),e(".tbds-price-rule-container").append(t)})),e(document).on("click",".tbds-price-rule-remove",(function(){let t=e(this),s=e(".tbds-price-rule-row"),r=t.closest(".tbds-price-rule-row");s.length>1&&confirm("Do you want to remove this row?")&&(r.fadeOut(300),setTimeout((function(){r.remove()}),300))})),e(document).on("change",'select[name="tbds_plus_value_type[]"]',(function(){s(e(this))})),e(document).on("change",'select[name="tbds_price_default[plus_value_type]"]',(function(){s(e(this))})),e(".vi-ui.button.primary").on("click",(function(){if(!e("#tbds-import-currency-rate").val())return alert("Please enter Import products currency exchange rate"),!1})),e(".tbds-generate-secretkey").on("click",(function(){var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890".split(""),s=[];for(let e=0;e<32;e++){var r=(Math.random()*(t.length-1)).toFixed(0);s[e]=t[r]}e(".tbds-secret-key").val(s.join(""))})),e(".tbds-copy-secretkey").on("click",(function(){let t=e(this).closest("td");t.find(".tbds-secret-key").select(),t.find(".tbds-copy-secretkey-success").remove(),document.execCommand("copy");let s=e('<span class="tbds-copy-secretkey-success dashicons dashicons-yes" title="Copied to Clipboard"></span>');t.append(s),s.fadeOut(1e4),setTimeout((function(){s.remove()}),1e4)})),e(".add-string-replace-rule").on("click",(function(){e(".string-replace tbody").append('<tr class="clone-source">\n                        <td>\n                            <input type="text" name="tbds_string_replace[from_string][]">\n                        </td>\n                         <td>\n                            <div class="tbds-string-replace-sensitive-container">\n                            <input type="checkbox" value="1" class="tbds-string-replace-sensitive">                            \n                            <input type="hidden" class="tbds-string-replace-sensitive-value" value="" name="tbds_string_replace[sensitive][]">\n                            </div>\n                        </td>\n                        <td>\n                            <input type="text" name="tbds_string_replace[to_string][]"  placeholder="Blank is delete">\n                        </td>\n                        <td>\n                            <button type="button" class="vi-ui button negative tiny delete-string-replace-rule">\n                                <i class="dashicons dashicons-trash "></i>\n                            </button>\n                        </td>\n                    </tr>')})),e("body").on("change",".tbds-string-replace-sensitive",(function(){let t=e(this).closest(".tbds-string-replace-sensitive-container").find(".tbds-string-replace-sensitive-value"),s=e(this).prop("checked")?1:"";t.val(s)})),e("body").on("click",".delete-string-replace-rule",(function(){confirm("Remove this item?")&&e(this).closest(".clone-source").remove()})),e(".add-string-replace-rule-url").on("click",(function(){e(".string-replace-url tbody").append('<tr class="clone-source">\n                        <td>\n                            <input type="text" value="" name="tbds-carrier_url_replaces[from_string][]">\n                        </td>\n                        <td>\n                            <input type="text" placeholder="URL of a replacement carrier" value="" name="tbds-carrier_url_replaces[to_string][]">\n                        </td>\n                        <td>\n                            <button type="button" class="vi-ui button negative tiny delete-string-replace-rule">\n                                <i class="dashicons dashicons-trash"></i>\n                            </button>\n                        </td>\n                    </tr>')})),e(".add-string-replace-rule-name").on("click",(function(){e(".string-replace-name tbody").append('<tr class="clone-source">\n                        <td>\n                            <input type="text" value="" name="tbds-carrier_name_replaces[from_string][]">\n                        </td>\n                         <td>\n                            <div class="tbds-string-replace-sensitive-container">\n                                <input type="checkbox" value="1" class="tbds-string-replace-sensitive">\n                                <input type="hidden" class="tbds-string-replace-sensitive-value" value="" name="tbds-carrier_name_replaces[sensitive][]">\n                            </div>\n                        </td>\n                        <td>\n                            <input type="text" placeholder="Blank is delete" value="" name="tbds-carrier_name_replaces[to_string][]">\n                        </td>                                       \n                        <td>\n                            <button type="button" class="vi-ui button negative tiny delete-string-replace-rule">\n                                <i class="dashicons dashicons-trash"></i>\n                            </button>\n                        </td>\n                    </tr>')})),e(document).on("click",".tbds-format-price-rules-duplicate",(function(){let t=e(this).closest("tr"),s=t.clone();s.find(".vi-ui.dropdown").viDropdown("set selected",t.find('select[name="tbds_format_price_rules[part][]"]').val()),s.insertAfter(t),r()})),e(document).on("click",".tbds-format-price-rules-remove",(function(){let t=e(this).closest("tr");confirm("Do you really want to remove this row?")&&(1===e(".tbds-format-price-rules-container>tr").length?(t.find('input[name="tbds_format_price_rules[from][]"]').val(0),t.find('input[name="tbds_format_price_rules[to][]"]').val(0),t.find('input[name="tbds_format_price_rules[value_from][]"]').val(0),t.find('input[name="tbds_format_price_rules[value_to][]"]').val(0),t.find('input[name="tbds_format_price_rules[value][]"]').val(0),t.find('select[name="tbds_format_price_rules[part][]"]').val("fraction").trigger("change")):(t.fadeOut(300),setTimeout((function(){t.remove(),r()}),300)))})),e(".tbds-format-price-rules-table").on("change",'select[name="tbds_format_price_rules[part][]"]',(function(){let t=e(this).closest("tr").find(".tbds-format-price-rules-label"),s=t.attr("class");"integer"===e(this).val()?t.attr("class",s.replace(" left "," right ")):t.attr("class",s.replace(" right "," left "))})).on("change",'select[name="tbds_format_price_rules[part][]"],input[name="tbds_format_price_rules[from][]"],input[name="tbds_format_price_rules[to][]"],input[name="tbds_format_price_rules[value_from][]"],input[name="tbds_format_price_rules[value_to][]"],input[name="tbds_format_price_rules[value][]"]',(function(){t(e(this).closest("tr"))})),e(".tbds-format-price-rules-test-button").on("click",(function(){let s=e(this);if(!s.hasClass("loading")){let r=0,a=[],n=e(".tbds-format-price-rules-test-result");e(".tbds-format-price-rules-container>tr").map((function(){let s=t(e(this));s>0?r+=s:a.push({from:e(this).find('input[name="tbds_format_price_rules[from][]"]').val(),to:e(this).find('input[name="tbds_format_price_rules[to][]"]').val(),part:e(this).find('select[name="tbds_format_price_rules[part][]"]').val(),value_from:e(this).find('input[name="tbds_format_price_rules[value_from][]"]').val(),value_to:e(this).find('input[name="tbds_format_price_rules[value_to][]"]').val(),value:e(this).find('input[name="tbds_format_price_rules[value][]"]').val()})})),0===r?(s.addClass("loading"),n.html(""),e.ajax({url:tbdsParams.url,type:"GET",dataType:"JSON",data:{action:"tbds_format_price_rules_test",format_price_rules_test:e(".tbds-format-price-rules-test").val(),format_price_rules:a},success:function(e){n.html(e.result)},error:function(e){n.html(e.statusText)},complete:function(){s.removeClass("loading")}})):alert("Please review your rules before continuing.")}})),e(".tbds-format-price-rules-container.ui-sortable").sortable({stop:function(e,t){r()}}),e("#tbds-show-shipping-option").on("change",(function(){let t=e("#tbds-shipping-cost-after-price-rules").closest("tr");e(this).prop("checked")?t.fadeIn(200):t.fadeOut(200)})).trigger("change"),e("#tbds-use-external-image").on("change",(function(){let t=e("#tbds-download-description-images").closest("tr");e(this).prop("checked")?t.fadeOut(200):t.fadeIn(200)})).trigger("change"),e(".woo-alidropship form").on("submit",(function(){e(".tbds-save-settings").addClass("loading")}))}));