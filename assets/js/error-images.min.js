jQuery(document).ready(function(a){"use strict";let f=!1;a(".tablenav-pages").find(".current-page").on("focus",function(a){f=!0}).on("blur",function(a){f=!1}),a('select[name="tbds_search_product_id"]').on("change",function(){let b=a(this).closest("form");f||b.find(".current-page").val(1),b.submit()}),a(".tbds-search-product-id").select2({placeholder:"Filter by product",allowClear:!0}),a(".tbds-search-product-id-ajax").select2({closeOnSelect:!0,allowClear:!0,placeholder:"Please enter product title to search",ajax:{url:"admin-ajax.php?action=wad_search_product_failed_images",dataType:"json",type:"GET",quietMillis:50,delay:250,data:function(b){return{keyword:b.term,p_id:a(this).closest("td").data("id")}},processResults:function(a){return{results:a}}},escapeMarkup:function(a){return a},minimumInputLength:1});let b=a(".tbds-action-download"),c=a(".tbds-action-download-all"),d=a(".tbds-action-delete"),e=a(".tbds-action-delete-all"),g=[],h=[],i=!1;c.on("click",function(){0===a(".tbds-button-all-container").find(".loading").length&&(a(".tbds-action-download").not(".loading").map(function(){0===a(this).closest(".tbds-actions-container").find(".loading").length&&g.push(a(this))}),g.length>0&&(g.shift().click(),c.addClass("loading")))}),e.on("click",function(){0===a(".tbds-button-all-container").find(".loading").length&&confirm(tbdsParams.i18n_confirm_delete_all)&&(a(".tbds-action-delete").not(".loading").map(function(){0===a(this).closest(".tbds-actions-container").find(".loading").length&&h.push(a(this))}),console.log(h),h.length>0&&(i=!0,h.shift().click(),e.addClass("loading")))}),d.on("click",function(){let b=a(this),d=b.closest("tr"),c=b.data("item_id");!b.hasClass("loading")&&(i||confirm(tbdsParams.i18n_confirm_delete))&&(b.addClass("loading"),b.find(".tbds-delete-image-error").remove(),a.ajax({url:tbdsParams.ajaxUrl,type:"POST",dataType:"JSON",data:{action:"tbds_delete_error_product_images",_ajax_nonce:tbdsParams.security,item_id:c},success:function(c){if(b.removeClass("loading"),"success"===c.status)d.remove(),0===a(".tbds-action-download").length&&a(".tbds-button-all-container").remove();else{let e=a('<span class="tbds-delete-image-error dashicons dashicons-no" title="'+c.message+'"></span>');b.append(e)}},error:function(a){console.log(a),b.removeClass("loading")},complete:function(){h.length>0?h.shift().click():(a(".tbds-action-delete-all").hasClass("loading")&&a(".tbds-action-delete-all").removeClass("loading"),i=!1)}}))}),b.on("click",function(){let b=a(this),d=b.closest("tr"),c=b.data("item_id");b.hasClass("loading")||(b.addClass("loading"),b.find(".tbds-download-image-error").remove(),a.ajax({url:tbdsParams.ajaxUrl,type:"POST",dataType:"JSON",data:{action:"tbds_download_error_product_images",_ajax_nonce:tbdsParams.security,item_id:c},success:function(c){if(b.removeClass("loading"),"success"===c.status)d.remove(),0===a(".tbds-action-download").length&&a(".tbds-button-all-container").remove();else{let e=a('<span class="tbds-download-image-error dashicons dashicons-no" title="'+c.message+'"></span>');b.append(e)}},error:function(a){console.log(a),b.removeClass("loading")},complete:function(){g.length>0?g.shift().click():a(".tbds-action-download-all").hasClass("loading")&&a(".tbds-action-download-all").removeClass("loading")}}))})})