jQuery(document).ready(a=>{"use strict";let c=[],d=!1,e=!1;a(".tablenav-pages").find(".current-page").on("focus",()=>e=!0).on("blur",()=>e=!1),a(".search-box").find('input[type="submit"]').on("click",function(){let b=a(this).closest("form");e||b.find(".current-page").val(1)}),a(".vi-ui.tabular.menu .item").viTab(),a(".vi-ui.accordion").vi_accordion("refresh"),a("select.vi-ui.dropdown").viDropdown();let f=a("#toplevel_page_woo-alidropship").find(".current").find(".tbds-imported-list-count");function b(){a(document).on("keydown",function(b){a(".tbds-delete-product-options-container").hasClass("tbds-hidden")||(13==b.keyCode?a(".tbds-delete-product-options-button-override").hasClass("tbds-hidden")?a(".tbds-delete-product-options-button-delete").hasClass("tbds-hidden")||a(".tbds-delete-product-options-button-delete").trigger("click"):(a(".tbds-delete-product-options-button-override").trigger("click"),a(".tbds-delete-product-options-override-product").focus()):27===b.keyCode&&a(".tbds-overlay").trigger("click"))})}function g(b,e,h){let j=a(`.tbds-button-delete[data-product_id="${b}"]`),i=a(`#tbds-product-item-id-${b}`);p(i),a.ajax({url:tbdsParams.ajaxUrl,type:"POST",dataType:"JSON",data:{action:"tbds_delete_product",_ajax_nonce:tbdsParams.security,product_id:b,woo_product_id:e,delete_woo_product:h},success:function(a){if("success"===a.status){let b=parseInt(f.html());if(b>0){let c=parseInt(b-1);f.html(c),f.parent().attr("class","update-plugins count-"+c)}i.fadeOut(300),setTimeout(function(){i.remove(),r()},300)}else q(i,"negative",a.message),i.removeClass("tbds-accordion-deleting").vi_accordion("open",0)},error:function(a){q(i,"negative",a.statusText),i.removeClass("tbds-accordion-deleting").vi_accordion("open",0)},complete:function(){if(d=!1,j.removeClass("loading"),c.length>0){let a=c.shift();g(a.product_id,a.woo_product_id,a.delete_woo_product)}}})}a(".tbds-button-view-and-edit").on("click",a=>a.stopPropagation()),b(),a(".tbds-button-trash").on("click",function(){let c=a(this),d=a(".tbds-imported-products-count-trash"),g=parseInt(d.html()),e=a(".tbds-imported-products-count-publish"),h=parseInt(e.html()),b={action:"tbds_trash_product",_ajax_nonce:tbdsParams.security,product_id:a(this).data("product_id")},i=a("#tbds-product-item-id-"+b.product_id);c.addClass("loading"),a.ajax({url:tbdsParams.ajaxUrl,type:"post",dataType:"JSON",data:b,success:function(c){if("success"===c.status){let a=parseInt(f.html());if(a>0){let b=a-1;f.html(b),f.parent().attr("class","update-plugins count-"+b)}g++,h--,i.fadeOut(300),setTimeout(function(){d.html(g),e.html(h),i.remove()},300)}},error:function(a){console.log(a)},complete:function(){c.removeClass("loading")}})}),a(".tbds-button-restore").on("click",function(){let c=a(this),d=a(".tbds-imported-products-count-trash"),g=parseInt(d.html()),e=a(".tbds-imported-products-count-publish"),h=parseInt(e.html()),b={action:"tbds_restore_product",_ajax_nonce:tbdsParams.security,product_id:a(this).data("product_id")},i=a("#tbds-product-item-id-"+b.product_id);c.addClass("loading"),a.ajax({url:tbdsParams.ajaxUrl,type:"post",dataType:"JSON",data:b,success:function(a){if(console.log(a),"success"===a.status){let b=parseInt(f.html());if(b>0){let c=b+1;f.html(c),f.parent().attr("class","update-plugins count-"+c)}g--,h++,i.fadeOut(300),setTimeout(function(){d.html(g),e.html(h),i.remove()},300)}},error:function(a){console.log(a)},complete:function(){c.removeClass("loading")}})}),a(".tbds-button-delete").on("click",function(){let b=a(this);if(!b.hasClass("loading")){let c=b.data().product_title,d=b.data().product_id,e=b.data().woo_product_id;a(".tbds-delete-product-options-product-title").html(c),a(".tbds-delete-product-options-button-delete").data("product_id",d).data("woo_product_id",e),l()}}),a(".tbds-delete-product-options-button-delete").on("click",function(){let e=a(this),b=e.data().product_id,f=e.data().woo_product_id;a(`.tbds-button-delete[data-product_id="${b}"]`).addClass("loading"),a(`#tbds-product-item-id-${b}`).addClass("tbds-accordion-deleting").vi_accordion("close",0);let h=a(".tbds-delete-product-options-delete-woo-product").prop("checked")?1:0;j(),d?c.push({product_id:b,woo_product_id:f,delete_woo_product:h}):(d=!0,g(b,f,h))}),a(".tbds-button-override").on("click",function(){let b=a(this),c=b.data().product_id,d=b.data().product_title,e=b.data().woo_product_id;a(".tbds-delete-product-options-product-title").html(d),a(".tbds-delete-product-options-button-override").data("product_id",c).data("woo_product_id",e),a(".tbds-delete-product-options-override-product-message").addClass("tbds-hidden"),k()});let h,i;function j(){a(".tbds-delete-product-options-content-header-delete").addClass("tbds-hidden"),a(".tbds-delete-product-options-button-delete").addClass("tbds-hidden").data("product_id","").data("woo_product_id",""),a(".tbds-delete-product-options-delete-woo-product-wrap").addClass("tbds-hidden"),a(".tbds-delete-product-options").addClass("tbds-delete-product-options-editing"),a(".tbds-delete-product-options-container").addClass("tbds-hidden"),n(),a(".tbds-delete-product-options-content-header-override").addClass("tbds-hidden"),a(".tbds-delete-product-options-button-override").addClass("tbds-hidden").data("product_id","").data("woo_product_id",""),a(".tbds-delete-product-options-override-product-wrap").addClass("tbds-hidden")}function k(){a(".tbds-delete-product-options-content-header-override").removeClass("tbds-hidden"),a(".tbds-delete-product-options-button-override").removeClass("tbds-hidden tbds-checked").html(tbdsParams.check),a(".tbds-delete-product-options-override-product-wrap").removeClass("tbds-hidden"),a(".tbds-delete-product-options-override-product-new-image").find("img").attr("src",""),a(".tbds-delete-product-options-override-product-new-title").html(""),a(".tbds-delete-product-options-override-product-new-wrap").addClass("tbds-hidden"),m(),a(".tbds-delete-product-options-override-product").val("").focus()}function l(){a(".tbds-delete-product-options-content-header-delete").removeClass("tbds-hidden"),a(".tbds-delete-product-options-button-delete").removeClass("tbds-hidden"),a(".tbds-delete-product-options-delete-woo-product-wrap").removeClass("tbds-hidden"),m()}function m(){a(".tbds-delete-product-options-container").removeClass("tbds-hidden"),o()}function n(){let b=parseInt(a("html").css("top"));a("html").removeClass("tbds-noscroll"),a("html,body").scrollTop(-b)}function o(){if(a(document).height()>a(window).height()){let b=a("html").scrollTop()?a("html").scrollTop():a("body").scrollTop();a("html").addClass("tbds-noscroll").css("top",-b)}}function p(a){a.find(".tbds-message").html("")}function q(a,b,c){a.find(".tbds-message").html(`<div class="vi-ui message ${b}"><div>${c}</div></div>`)}function r(){if(0===a(".tbds-accordion").length){let b=new URL(document.location.href);b.searchParams.delete("tbds_search_woo_id"),b.searchParams.delete("tbds_search_id"),b.searchParams.delete("tbds_search"),b.searchParams.delete("paged"),document.location.href=b.href}}a(".tbds-delete-product-options-override-product-new-close").on("click",function(){a(".tbds-delete-product-options-override-product-message").addClass("tbds-hidden").html(""),a(".tbds-delete-product-options-override-product-new-wrap").addClass("tbds-hidden"),a(".tbds-delete-product-options-button-override").html("Check").removeClass("tbds-checked"),a(".tbds-delete-product-options-override-product").val("").focus(),h="",i=""}),a(".tbds-delete-product-options-button-override").on("click",function(){let b=a(this),d=a("#tbds-delete-product-options-override-product").val(),e=b.data("product_id"),f=b.data("woo_product_id"),g=a('.tbds-button-override[data-product_id="'+e+'"]'),c="check";if(b.hasClass("tbds-checked")&&(c="override"),"check"===c){if(!d){alert("Please enter url or ID of product you want to use to override current product with");return}}else if(!h&&!i){alert("Please enter product url to check.");return}a(".tbds-delete-product-options-override-product-message").addClass("tbds-hidden"),g.addClass("loading"),b.addClass("loading"),a.ajax({url:tbdsParams.ajaxUrl,type:"POST",dataType:"JSON",data:{action:"tbds_override_product",_ajax_nonce:tbdsParams.security,product_id:e,woo_product_id:f,override_product_url:d,override_product_data:h,override_product_id:i,step:c,replace_description:a(".tbds-delete-product-options-override-product-replace-description").prop("checked")?1:0},success:function(d){if("check"===c)"error"===d.status?a(".tbds-delete-product-options-override-product-message").removeClass("tbds-hidden").html(d.message):(console.log(d.redirect_url),window.open(d.redirect_url,"_blank"));else if("success"===d.status){let f=a("#tbds-product-item-id-"+e);f.find("div.content").eq(0).prepend(d.data),g.remove(),f.find(".tbds-button-override-container").append(d.button_override_html),j()}else b.html(tbdsParams.check).removeClass("tbds-checked"),d.message&&a(".tbds-delete-product-options-override-product-message").removeClass("tbds-hidden").html(d.message)},error:function(a){console.log(a)},complete:function(){g.removeClass("loading"),b.removeClass("loading")}})}),a(".tbds-overlay").on("click",()=>j()),a(".tbds-delete-product-options-close").on("click",()=>j()),a(".tbds-delete-product-options-button-cancel").on("click",()=>j()),a(".tbds-accordion-store-url").on("click",a=>a.stopPropagation())})