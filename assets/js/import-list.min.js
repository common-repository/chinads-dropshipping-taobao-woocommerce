jQuery(document).ready((t=>{"use strict";function e(t,e){const i=t=>decodeURIComponent(t.replace(/\+/g,"%20")),a=String(t).replace(/^&/,"").replace(/&$/,"").split("&"),s=a.length;let o,d,n,r,c,l,b,p,u,v,m,f,h;const g="undefined"!=typeof window?window:global;g.$locutus=g.$locutus||{};const _=g.$locutus;for(_.php=_.php||{},e||(e=g),o=0;o<s&&(p=a[o].split("="),u=i(p[0]),v=p.length<2?"":i(p[1]),!(u.includes("__proto__")||u.includes("constructor")||u.includes("prototype")));o++){for(;" "===u.charAt(0);)u=u.slice(1);if(u.indexOf("\0")>-1&&(u=u.slice(0,u.indexOf("\0"))),u&&"["!==u.charAt(0)){for(f=[],m=0,d=0;d<u.length;d++)if("["!==u.charAt(d)||m){if("]"===u.charAt(d)&&m&&(f.length||f.push(u.slice(0,m-1)),f.push(u.substr(m,d-m)),m=0,"["!==u.charAt(d+1)))break}else m=d+1;for(f.length||(f=[u]),d=0;d<f[0].length&&(b=f[0].charAt(d)," "!==b&&"."!==b&&"["!==b||(f[0]=f[0].substr(0,d)+"_"+f[0].substr(d+1)),"["!==b);d++);for(l=e,d=0,h=f.length;d<h;d++){if(u=f[d].replace(/^['"]/,"").replace(/['"]$/,""),c=l,(""===u||" "===u)&&0!==d){for(r in n=-1,l)l.hasOwnProperty(r)&&+r>n&&r.match(/^\d+$/g)&&(n=+r);u=n+1}Object(l[u])!==l[u]&&(l[u]={}),l=l[u]}c[u]=v}}}let i,a=[],s=!1,o=!1;function d(t,e,i){t.find(".tbds-message").html(`<div class="vi-ui message ${e}"><div>${i}</div></div>`)}t(".tablenav-pages").find(".current-page").on("focus",(function(t){o=!0})).on("blur",(function(t){o=!1})),t(".search-box").find('input[type="submit"]').on("click",(function(){let e=t(this).closest("form");o||e.find(".current-page").val(1)})),t(".vi-ui.tabular.menu .item").viTab(),t(".vi-ui.accordion").vi_accordion("refresh"),t(".ui-sortable").sortable(),t("select.vi-ui.dropdown").not(".tbds-accordion-bulk-actions,.tbds-modal-popup-set-shipping-class-select,.tbds-import-data-shipping-class,.tbds-import-data-tags,.tbds-modal-popup-set-tags-select").viDropdown(),t(".tbds-accordion-bulk-actions").viDropdown({placeholder:"auto"}),t(".tbds-modal-popup-set-shipping-class-select,.tbds-import-data-shipping-class").viDropdown({placeholder:""}),t(".tbds-import-data-tags,.tbds-modal-popup-set-tags-select").viDropdown({allowAdditions:!0}),t(".tbds-button-view-and-edit").on("click",(function(t){t.stopPropagation()})),t(".tbds-import-data-categories,.tbds-modal-popup-set-categories-select").viDropdown({onAdd:function(e,i,a){t(this).find("a.ui.label").map((function(){let e=t(this);e.html(e.html().replace(/&nbsp;/g,""))}))}}),tbdsParams.product_categories&&t(".tbds-import-data-categories").viDropdown("set exactly",tbdsParams.product_categories).trigger("change"),t("body").on("click",".tbds-attribute-filter-item",(function(e){let i=t(this),a=[],s=i.closest("table"),o=s.find(".tbds-attribute-filter-list"),d=o.eq(0),n=d.data("attribute_slug");i.hasClass("tbds-attribute-filter-item-active")?i.removeClass("tbds-attribute-filter-item-active"):i.addClass("tbds-attribute-filter-item-active");let r=s.find(".tbds-product-variation-row"),c=d.find(".tbds-attribute-filter-item-active"),l=[];if(c.length>0){c.map((function(){a.push(t(this).data("attribute_value"))}));for(let t=0;t<r.length;t++){let e=r.eq(t).find('.tbds-import-data-variation-attribute[data-attribute_slug="'+n+'"]');a.indexOf(e.data("attribute_value"))>-1?l[t]=1:l[t]=0}}else for(let t=0;t<r.length;t++)l[t]=1;if(o.length>1)for(let e=1;e<o.length;e++)if(d=o.eq(e),n=d.data("attribute_slug"),c=d.find(".tbds-attribute-filter-item-active"),c.length>0){c.map((function(){a.push(t(this).data("attribute_value"))}));for(let t=0;t<r.length;t++){let e=r.eq(t).find('.tbds-import-data-variation-attribute[data-attribute_slug="'+n+'"]');a.indexOf(e.data("attribute_value"))<0&&(l[t]=0)}}let b=0;for(let t=0;t<r.length;t++){let e=r.eq(t);1==l[t]?(e.removeClass("tbds-variation-filter-inactive"),e.find(".tbds-variation-enable").prop("checked")&&b++):e.addClass("tbds-variation-filter-inactive")}i.closest("form").find(".tbds-selected-variation-count").html(b)})),t("body").on("click",".tbds-set-product-image",(function(e){e.stopPropagation();let i=t(this),a=i.closest("form").find(".tbds-product-image"),s=i.closest(".tbds-product-gallery-item"),o=i.closest(".tbds-product-gallery");if(s.hasClass("tbds-is-product-image"))s.removeClass("tbds-is-product-image"),a.removeClass("tbds-selected-item"),a.find('input[type="hidden"]').val("");else{s.hasClass("tbds-selected-item")||s.click(),a.hasClass("tbds-selected-item")||a.addClass("tbds-selected-item"),o.find(".tbds-product-gallery-item").removeClass("tbds-is-product-image"),s.addClass("tbds-is-product-image");let e=s.find("img").data("image_src");t(this).closest(".tbds-accordion").find(".tbds-accordion-product-image").attr("src",e),a.find("img").attr("src",e),a.find('input[type="hidden"]').val(e)}})),t(document).on("keydown",(function(e){t(".tbds-set-price-container").hasClass("tbds-hidden")?t(".tbds-override-product-options-container").hasClass("tbds-hidden")||(13==e.keyCode?t(".tbds-override-product-options-button-override").click():27==e.keyCode&&t(".tbds-override-product-overlay").click()):13==e.keyCode?t(".tbds-set-price-button-set").click():27==e.keyCode&&t(".tbds-overlay").click()})),t("body").on("click",".tbds-variations-bulk-enable",(function(){let e=t(this).closest("form"),i=0;t(this).prop("checked")?(i=e.find(".tbds-product-variation-row").length-e.find(".tbds-variation-filter-inactive").length,e.find(".tbds-variations-bulk-select-image").prop("checked",!0).trigger("change")):(e.find(".tbds-import-data-variation-default").prop("checked",!1),e.find(".tbds-variations-bulk-select-image").prop("checked",!1).trigger("change")),e.find(".tbds-selected-variation-count").html(i)})).on("click",".tbds-variation-enable",(function(e){let a=t(this),s=a.closest("form"),o=s.find(".tbds-variation-enable").index(i),d=0;if(e.shiftKey){let t=s.find(".tbds-variation-enable").index(a);if(a.prop("checked"))if(o<t)for(let e=o;e<=t;e++)s.find(".tbds-variation-enable").eq(e).prop("checked",!0);else for(let e=t;e<=o;e++)s.find(".tbds-variation-enable").eq(e).prop("checked",!0);else if(o<t)for(let e=o;e<=t;e++)s.find(".tbds-variation-enable").eq(e).prop("checked",!1);else for(let e=t;e<=o;e++)s.find(".tbds-variation-enable").eq(e).prop("checked",!1)}s.find(".tbds-variation-enable").map((function(){let e=t(this).closest("tr");t(this).prop("checked")&&!e.hasClass("tbds-variation-filter-inactive")?(d++,e.find(".tbds-variation-image").removeClass("tbds-selected-item").click()):(e.find(".tbds-variation-image").addClass("tbds-selected-item").click(),e.find(".tbds-import-data-variation-default").prop("checked",!1))})),s.find(".tbds-selected-variation-count").html(d),i=t(this)})),t("body").on("change",".tbds-variations-bulk-enable",(function(){t(this).closest("form").find(".tbds-product-variation-row:not(.tbds-variation-filter-inactive) .tbds-variation-enable").prop("checked",t(this).prop("checked"))})),t("body").on("change",".tbds-variations-bulk-select-image",(function(){let e=t(this),i=e.closest("form").find(".tbds-variation-image");e.prop("checked")?i.addClass("tbds-selected-item"):i.removeClass("tbds-selected-item"),i.map((function(){let i=t(this);e.prop("checked")?i.find('input[type="hidden"]').val(i.find(".tbds-import-data-variation-image").attr("src")):i.find('input[type="hidden"]').val("")}))}));let n=t("#toplevel_page_woo-alidropship").find(".current").find(".tbds-import-list-count"),r=t(".tbds-imported-list-count");t(".tbds-button-empty-import-list").on("click",(function(t){if(!confirm("Do you want to delete all products(except overriding products) from your Import list?"))return t.preventDefault(),!1}));let c,l,b=!1;function p(){t(".tbds-set-price").removeClass("tbds-set-price-editing"),t(".tbds-attributes-attribute-removing").removeClass("tbds-attributes-attribute-removing"),t(".tbds-modal-popup-container").addClass("tbds-hidden"),m()}function u(){t(".tbds-modal-popup-container").removeClass("tbds-hidden"),f()}function v(){t(".tbds-override-product-options-container").addClass("tbds-hidden"),c=[],l=0,m()}function m(){let e=parseInt(t("html").css("top"));t("html").removeClass("tbds-noscroll"),t("html,body").scrollTop(-e)}function f(){if(t(document).height()>t(window).height()){let e=t("html").scrollTop()?t("html").scrollTop():t("body").scrollTop();t("html").addClass("tbds-noscroll").css("top",-e)}}function h(t){let e=parseInt(tbdsParams.decimals),i=Math.pow(10,e);return Math.round(t*i)/i}function g(){let e=t(".tbds-accordion-bulk-item-check"),i=t(".tbds-accordion-bulk-actions-container");if("none"!==i.css("display"))if(e.length>0){let a=0;e.map((function(){t(this).prop("checked")&&a++})),0===a&&i.fadeOut(200)}else i.fadeOut(200)}t(".tbds-button-remove").on("click",(function(e){e.stopPropagation();let i=t(this),a=i.data("product_id"),s=t("#tbds-product-item-id-"+a);0===i.closest(".tbds-button-view-and-edit").find(".loading").length&&(b||confirm(tbdsParams.i18n_remove_product_confirm))&&(s.vi_accordion("close",0).addClass("tbds-accordion-removing"),i.addClass("loading"),s.find(".tbds-message").html(""),t.ajax({url:tbdsParams.ajaxUrl,type:"POST",dataType:"JSON",data:{action:"tbds_remove",_ajax_nonce:tbdsParams.security,product_id:a},success:function(e){if("success"===e.status){let e=parseInt(n.html());if(e>0){let t=parseInt(e-1);n.html(t),n.parent().attr("class","update-plugins count-"+t)}s.fadeOut(300),setTimeout((function(){s.remove(),function(){if(0===t(".tbds-accordion").length){let t=new URL(document.location.href);t.searchParams.delete("tbds_search_id"),t.searchParams.delete("tbds_search"),t.searchParams.delete("paged"),document.location.href=t.href}}(),g()}),300)}else s.vi_accordion("open",0).removeClass("tbds-accordion-removing"),d(s,"negative",e.message?e.message:"Error")},error:function(t){console.log(t),s.vi_accordion("open",0).removeClass("tbds-accordion-removing"),d(s,"negative",t.statusText)},complete:function(){i.removeClass("loading")}}))})),t(".tbds-button-import").on("click",(function(i){i.stopPropagation();let o={},c=t(this),l=c.closest(".tbds-button-view-and-edit"),b=c.data("product_id"),p=t("#tbds-product-item-id-"+b);if(p.hasClass("tbds-accordion-importing")||p.hasClass("tbds-accordion-removing")||p.hasClass("tbds-accordion-splitting"))return;let u=p.find(".tbds-product-container"),v=u.find(".vi-ui.tab").not(".tbds-variations-tab").find("input,select,textarea").serializeArray(),m=t("#wp-tbds-product-description-"+b+"-wrap").hasClass("tmce-active")?tinyMCE.get("tbds-product-description-"+b).getContent():t("#tbds-product-description-"+b).val();v.push({name:"tbds_product["+b+"][description]",value:m});let f={};if(u.find(".tbds-variation-enable").length>0){let e=[],i=0;u.find(".tbds-variation-enable").map((function(){let a=t(this).closest(".tbds-product-variation-row");if(t(this).prop("checked")&&!a.hasClass("tbds-variation-filter-inactive")){e.push(i);let t=a.find("input,select,textarea").serializeArray();if(t.length>0)for(let e=0;e<t.length;e++)v.push(t[e])}i++})),f[b]=e}else f[b]=[0];if(v.push({name:"z_check_max_input_vars",value:1}),v=t.param(v),e(v,o),0===f[b].length)return void alert(tbdsParams.i18n_empty_variation_error);let h=!1,_=!1;u.find(".tbds-import-data-variation-sale-price").removeClass("tbds-price-error"),u.find(".tbds-import-data-variation-regular-price").removeClass("tbds-price-error");for(let t=0;t<u.find(".tbds-import-data-variation-sale-price").length;t++){let e=u.find(".tbds-import-data-variation-sale-price").eq(t),i=u.find(".tbds-import-data-variation-regular-price").eq(t);parseFloat(i.val())?parseFloat(e.val())>parseFloat(i.val())&&(_=!0,e.addClass("tbds-price-error")):(h=!0,i.addClass("tbds-price-error"))}h?alert(tbdsParams.i18n_empty_price_error):_?alert(tbdsParams.i18n_sale_price_error):(c.addClass("loading"),s?a.push(c):(p.vi_accordion("close",0).addClass("tbds-accordion-importing"),s=!0,t.ajax({url:tbdsParams.ajaxUrl,type:"POST",dataType:"JSON",data:{action:"tbds_import",_ajax_nonce:tbdsParams.security,form_data:o,selected:f},success:function(e){if("success"===e.status){let i=parseInt(n.html());i>0?(i--,n.html(i),n.parent().attr("class","update-plugins count-"+i)):(n.html(0),n.parent().attr("class","update-plugins count-0"));let a=parseInt(r.html());a++,r.html(a),r.parent().attr("class","update-plugins count-"+a),0===t(".tbds-button-import").length&&t(".tbds-button-import-all").remove(),l.append(e.button_html),l.find(".tbds-button-remove").remove(),c.remove(),p.find(".content").remove(),p.find(".tbds-accordion-title-icon").attr("class","icon check green"),g()}else c.removeClass("loading"),d(p,"negative",e.message?e.message:"Error")},error:function(t){console.log(t),c.removeClass("loading"),d(p,"negative",t.statusText)},complete:function(){s=!1,p.vi_accordion("open",0).removeClass("tbds-accordion-importing"),a.length>0?a.shift().click():t(".tbds-button-import-all").hasClass("loading")&&t(".tbds-button-import-all").removeClass("loading")}})))})),t(".tbds-button-import-all").on("click",(function(){let e=t(this);e.hasClass("loading")||confirm(tbdsParams.i18n_import_all_confirm)&&(t(".tbds-button-import").not(".loading").map((function(){0===t(this).closest(".tbds-button-view-and-edit").find(".loading").length&&(a.push(t(this)),t(this).addClass("loading"))})),a.length>0?(s||a.shift().click(),e.addClass("loading")):alert(tbdsParams.i18n_not_found_error))})),t(".tbds-button-override").on("click",(function(e){e.stopPropagation();let i=t(this),a=i.data("product_id"),s=i.closest(".tbds-accordion").find(".tbds-product-container"),o={};if(s.find(".tbds-variation-enable").length>0){let e=[],i=0;s.find(".tbds-variation-enable").map((function(){let a=t(this).closest(".tbds-product-variation-row");t(this).prop("checked")&&!a.hasClass("tbds-variation-filter-inactive")&&e.push(i),i++})),o[a]=e}else o[a]=[0];if(0===o[a].length)return void alert(tbdsParams.i18n_empty_variation_error);let d=!1,n=!1,r=i.closest(".tbds-accordion").find(".tbds-product-container");r.find(".tbds-import-data-variation-sale-price").removeClass("tbds-price-error"),r.find(".tbds-import-data-variation-regular-price").removeClass("tbds-price-error");for(let t=0;t<r.find(".tbds-import-data-variation-sale-price").length;t++){let e=r.find(".tbds-import-data-variation-sale-price").eq(t),i=r.find(".tbds-import-data-variation-regular-price").eq(t);parseFloat(i.val())?parseFloat(e.val())>parseFloat(i.val())&&(n=!0,e.addClass("tbds-price-error")):(d=!0,i.addClass("tbds-price-error"))}if(d)return void alert(tbdsParams.i18n_empty_price_error);if(n)return void alert(tbdsParams.i18n_sale_price_error);let b=r.find(".tbds-override-woo-id");b.val()?t(".tbds-override-product-title").html(b.find(":selected").html()):t(".tbds-override-product-title").html(i.closest(".tbds-accordion").find(".tbds-override-product-product-title").html()),t(".tbds-override-product-options-button-override").data("product_id",a).data("override_product_id",i.data("override_product_id")),function(e){let i=t(".tbds-override-product-options-container");e.hasClass("tbds-button-map-existing")?i.addClass("tbds-override-product-options-container-map-existing"):i.removeClass("tbds-override-product-options-container-map-existing");e.hasClass("tbds-button-reimport")?i.addClass("tbds-override-product-options-container-reimport"):i.removeClass("tbds-override-product-options-container-reimport");i.removeClass("tbds-hidden"),t(".tbds-override-product-options-content-body-override-old").addClass("tbds-hidden");let a=t(".tbds-override-product-options-content-body-option");a.length>0?a.removeClass("tbds-hidden"):t(".tbds-override-product-options-button-override").click();c=[],l=0,f()}(i)})),t(".tbds-override-woo-id").on("change",(function(){let e=t(this).closest(".tbds-accordion"),i=e.find(".tbds-button-import"),a=e.find(".tbds-button-override");t(this).val()?(i.addClass("tbds-hidden"),a.removeClass("tbds-hidden")):(i.removeClass("tbds-hidden"),a.addClass("tbds-hidden"))})),t(".tbds-override-product-options-override-keep-product").on("change",(function(){let e=t(this),i=e.closest(".tbds-override-product-options-container").find(".tbds-override-product-remove-warning"),a=t(".tbds-override-product-options-content-body-row-override-find-in-orders");e.prop("checked")?(i.fadeOut(100),a.hide()):(i.fadeIn(100),a.show())})).trigger("change"),t(".tbds-override-product-options-button-override").on("click",(function(){let i=t(this),a=i.data("product_id"),s=i.data("override_product_id"),o=t('.tbds-button-override[data-product_id="'+a+'"]'),d=o.closest(".tbds-button-view-and-edit"),n=t("#tbds-product-item-id-"+a),r=n.find(".tbds-product-container"),b=r.find(".vi-ui.tab").not(".tbds-variations-tab").find("input,select,textarea").serializeArray(),p=t("#wp-tbds-product-description-"+a+"-wrap").hasClass("tmce-active")?tinyMCE.get("tbds-product-description-"+a).getContent():t("#tbds-product-description-"+a).val();b.push({name:"tbds_product["+a+"][description]",value:p});let u={};if(r.find(".tbds-variation-enable").length>0){let e=[],i=0;r.find(".tbds-variation-enable").map((function(){let a=t(this).closest(".tbds-product-variation-row");if(t(this).prop("checked")&&!a.hasClass("tbds-variation-filter-inactive")){e.push(i);let t=a.find("input,select,textarea").serializeArray();if(t.length>0)for(let e=0;e<t.length;e++)b.push(t[e])}i++})),u[a]=e}else u[a]=[0];b.push({name:"z_check_max_input_vars",value:1}),b=t.param(b);let m={},f={};e(b,m),l&&t(".tbds-override-order-container").map((function(){f[t(this).data("replace_item_id")]=t(this).find(".tbds-override-with").val()})),o.addClass("loading"),i.addClass("loading");let h=t(".tbds-override-product-options-override-hide").prop("checked")?1:0;t.ajax({url:tbdsParams.ajaxUrl,type:"POST",dataType:"JSON",data:{action:"tbds_override",_ajax_nonce:tbdsParams.security,form_data:m,selected:u,override_product_id:s,check_orders:l,replace_items:f,found_items:c,override_woo_id:n.find(".tbds-override-woo-id").val(),override_keep_product:t(".tbds-override-product-options-override-keep-product").prop("checked")?1:0,override_title:t(".tbds-override-product-options-override-title").prop("checked")?1:0,override_images:t(".tbds-override-product-options-override-images").prop("checked")?1:0,override_description:t(".tbds-override-product-options-override-description").prop("checked")?1:0,override_find_in_orders:t(".tbds-override-product-options-override-find-in-orders").prop("checked")?1:0,override_hide:h},success:function(e){if(l)"success"===e.status?(v(),d.append(e.button_html),d.find(".tbds-button-remove").remove(),o.remove(),n.find(".content").remove(),n.find(".tbds-accordion-bulk-item-check").remove(),n.find(".tbds-accordion-title-icon").attr("class","icon check green"),g()):alert(e.message);else if("checked"===e.status){t(".tbds-override-product-options-content-body-override-old").removeClass("tbds-hidden").html(e.replace_order_html),l=1,c=e.found_items,1===h?t(".tbds-override-product-options-content-body-option").remove():t(".tbds-override-product-options-content-body-option").addClass("tbds-hidden")}else"success"===e.status?(v(),d.append(e.button_html),d.find(".tbds-button-remove").remove(),o.remove(),n.find(".content").remove(),n.find(".tbds-accordion-bulk-item-check").remove(),n.find(".tbds-accordion-title-icon").attr("class","icon check green"),g()):alert(e.message)},error:function(t){console.log(t)},complete:function(){o.removeClass("loading"),i.removeClass("loading")}})})),t(document).on("change",".tbds-override-with-attributes>select",(function(e){if(t(".tbds-override-product-options-override-keep-product").prop("checked")||t(".tbds-override-product-options-container").hasClass("tbds-override-product-options-container-reimport")||t(".tbds-override-product-options-container").hasClass("tbds-override-product-options-container-map-existing")){let e=t(this),i=e.val(),a=e.data("prev_value");t(".tbds-override-with-attributes>select").not(t(this)).map((function(){let e=t(this);i&&e.find(`option[value="${i}"]`).prop("disabled",!0),a&&e.find(`option[value="${a}"]`).prop("disabled",!1)})),e.data("prev_value",i)}})),t(".tbds-import-data-variation-sale-price").on("change",(function(){let e=t(this),i=e.closest("tr"),a=parseFloat(e.val()),s=i.find(".tbds-import-data-variation-profit"),o=i.find(".tbds-import-data-variation-cost"),d=0;d=a?a-parseFloat(o.html()):parseFloat(i.find(".tbds-import-data-variation-regular-price").val())-parseFloat(o.html()),s.html(h(d))})),t(".tbds-import-data-variation-regular-price").on("change",(function(){let e=t(this),i=e.closest("tr"),a=parseFloat(i.find(".tbds-import-data-variation-sale-price").val()),s=i.find(".tbds-import-data-variation-profit"),o=i.find(".tbds-import-data-variation-cost"),d=0;a||(d=parseFloat(e.val())-parseFloat(o.html()),s.html(h(d)))})),t("body").on("click",".tbds-set-price",(function(){let e=t(this);e.addClass("tbds-set-price-editing"),t(".tbds-modal-popup-container").attr("class","tbds-modal-popup-container tbds-modal-popup-container-set-price"),t(".tbds-modal-popup-content-set-price").find(".tbds-modal-popup-header").find("h2").html("Set "+e.data("set_price").replace(/_/g," ")),u()})),t("body").on("click",".tbds-product-gallery-item",(function(){let e=t(this),i=e.find(".tbds-product-gallery-image"),a=e.closest("form"),s=a.find(".tbds-product-gallery"),o=a.find(".tbds-product-image");e.hasClass("tbds-selected-item")?(e.hasClass("tbds-is-product-image")&&(e.removeClass("tbds-is-product-image"),e.find("tbds-set-product-image").click(),o.removeClass("tbds-selected-item").find('input[type="hidden"]').val("")),e.removeClass("tbds-selected-item").find('input[type="hidden"]').val("")):e.addClass("tbds-selected-item").find('input[type="hidden"]').val(i.data("image_src")),a.find(".tbds-selected-gallery-count").html(s.find(".tbds-selected-item").length)})),t("body").on("click",".tbds-product-image",(function(){let e=t(this).find(".tbds-import-data-image").attr("src"),i=t(this).closest("form");if(e){i.find('.tbds-product-gallery-image[data-image_src="'+e+'"]').closest(".tbds-product-gallery-item").find(".tbds-set-product-image").click()}})),t("body").on("click",".tbds-import-data-variation-default",(function(){let e=t(this);if(e.prop("checked")){let t=e.closest("tr").find(".tbds-variation-enable");t.prop("checked")||t.click()}})),t("body").on("click",".tbds-variation-image",(function(){let e=t(this);e.hasClass("tbds-selected-item")?e.removeClass("tbds-selected-item").find('input[type="hidden"]').val(""):(e.addClass("tbds-selected-item").find('input[type="hidden"]').val(e.find("img").attr("src")),e.closest("tr").find(".tbds-variation-enable").prop("checked",!0))})),t(".tbds-overlay").on("click",(function(){p()})),t(".tbds-modal-popup-close").on("click",(function(){p()})),t(".tbds-set-price-button-cancel").on("click",(function(){p()})),t(".tbds-set-price-amount").on("change",(function(){let e=parseFloat(t(this).val());isNaN(e)&&(e=0),t(this).val(e)})),t(".tbds-set-price-button-set").on("click",(function(){t(this);let e,i=t(".tbds-set-price-action").val(),a=parseFloat(t(".tbds-set-price-amount").val()),s=t(".tbds-set-price-editing"),o=s.closest("table");if(e="sale_price"===s.data("set_price")?o.find(".tbds-import-data-variation-sale-price"):o.find(".tbds-import-data-variation-regular-price"),e.length>0)switch(i){case"set_new_value":e.map((function(){let e=t(this),i=e.closest(".tbds-product-variation-row");!i.hasClass("tbds-variation-filter-inactive")&&i.find(".tbds-variation-enable").prop("checked")&&e.val(a)}));break;case"increase_by_fixed_value":e.map((function(){let e=t(this),i=e.closest(".tbds-product-variation-row"),s=parseFloat(e.val());!i.hasClass("tbds-variation-filter-inactive")&&i.find(".tbds-variation-enable").prop("checked")&&e.val(s+a)}));break;case"increase_by_percentage":e.map((function(){let e=t(this),i=e.closest(".tbds-product-variation-row"),s=parseFloat(e.val());!i.hasClass("tbds-variation-filter-inactive")&&i.find(".tbds-variation-enable").prop("checked")&&e.val((1+a/100)*s)}))}o.find(".tbds-import-data-variation-profit").map((function(){let e=t(this),i=e.closest("tr");if(!i.hasClass("tbds-variation-filter-inactive")&&i.find(".tbds-variation-enable").prop("checked")){let t,a=i.find(".tbds-import-data-variation-sale-price"),s=i.find(".tbds-import-data-variation-regular-price"),o=i.find(".tbds-import-data-variation-cost"),d=parseFloat(a.val()),n=parseFloat(s.val()),r=parseFloat(o.html());t=h(d?d-r:n-r),e.html(t)}})),p()})),t(".tbds-accordion-store-url").on("click",(function(t){t.stopPropagation()})),t(".tbds-lazy-load").on("click",(function(){let e=t(this),i=e.data("tab");if(!e.hasClass("tbds-lazy-load-loaded")){e.addClass("tbds-lazy-load-loaded"),t('.tbds-lazy-load-tab-data[data-tab="'+i+'"]').find("img").map((function(){let e=t(this).data("image_src");e&&t(this).attr("src",e)}))}})),t(".tbds-variations-tab-menu").on("click",(function(){let e=t(this),i=e.closest(".tbds-accordion").find(".tbds-product-overlay"),a=e.data("tab"),s=t('.tbds-variations-tab[data-tab="'+a+'"]'),o=s.find(".tbds-variations-table");s.hasClass("tbds-variations-tab-loaded")||(i.removeClass("tbds-hidden"),t.ajax({url:tbdsParams.ajaxUrl,type:"GET",dataType:"JSON",data:{action:"tbds_load_variations_table",_ajax_nonce:tbdsParams.security,product_id:s.data("product_id"),product_index:a.substring(11)},success:function(t){let e;"success"===t.status?(s.addClass("tbds-variations-tab-loaded"),e=t.data,t.hasOwnProperty("split_option")&&t.split_option&&o.closest(".tbds-variations-tab").find(".tbds-button-split-container").html(t.split_option)):e=`<div class="vi-ui negative message">${t.data}</div>`,o.html(e).find(".vi-ui.dropdown").viDropdown({fullTextSearch:!0,forceSelection:!1,selectOnKeydown:!1})},error:function(t){console.log(t),o.html('<div class="vi-ui negative message">ERROR</div>')},complete:function(){i.addClass("tbds-hidden")}}))})),t(".tbds-override-product-overlay").on("click",(function(){v()})),t(".tbds-override-product-options-close").on("click",(function(){v()})),t(".tbds-override-product-options-button-cancel").on("click",(function(){v()})),t(document).on("click",".tbds-attributes-button-save",(function(){let i=t(this),a=i.closest(".tbds-accordion"),s=i.closest("tr"),o=0,d=s.find(".tbds-attributes-attribute-value"),n=s.find(".tbds-attributes-attribute-slug"),r=a.find(".tbds-product-overlay"),c=s.find(".tbds-attributes-attribute-name");if(!c.val())return void alert(tbdsParams.i18n_empty_attribute_name);c.val()!==c.data("attribute_name")&&o++;let l=[];if(d.map((function(){let e=t(this).val();e!==t(this).data("attribute_value")&&o++,e=e.toLowerCase().trim(),e&&-1===l.indexOf(e)&&l.push(e)})),l.length===d.length||i.hasClass("vichinads-attributes-button-save-loading"))if(o>0){let o={};e(s.find("input").serialize(),o),r.removeClass("tbds-hidden"),t.ajax({url:tbdsParams.ajaxUrl,type:"POST",dataType:"JSON",data:{action:"tbds_save_attributes",_ajax_nonce:tbdsParams.security,form_data:o},success:function(e){if("success"===e.status){let i=!1;e.new_slug&&(i=!0,n.html(e.new_slug),c.data("attribute_name",c.val())),!0===e.change_value&&(i=!0,s.find(".tbds-attributes-attribute-value").map((function(){let e=t(this);e.data("attribute_value",e.val())}))),i&&a.find(".tbds-variations-tab").removeClass("tbds-variations-tab-loaded")}},error:function(t){console.log(t)},complete:function(){i.removeClass("loading vichinads-attributes-button-save-loading"),s.removeClass("tbds-attributes-attribute-editing"),s.closest(".tbds-product-row").find(".vichinads-attributes-button-save-loading").length?s.closest(".tbds-product-row").find(".vichinads-attributes-button-save-loading").eq(0).trigger("click"):(r.addClass("tbds-hidden"),a.find(".tbds-variations-tab-menu.active").length&&(a.find(".tbds-variations-tab-loaded").removeClass("tbds-variations-tab-loaded"),a.find(".tbds-variations-tab-menu").trigger("click")))}})}else i.removeClass("loading vichinads-attributes-button-save-loading"),s.closest(".tbds-product-row").find(".vichinads-attributes-button-save-loading").eq(0).trigger("click");else alert(tbdsParams.i18n_invalid_attribute_values)})),t(document).on("click",".tbds-attributes-button-trans",(function(){let e=t(this).closest("tr"),i=t(this).find("i"),a=[];i.addClass("spinner"),e.find("input").each((function(e){let i=t(this),s=i.val(),o=_(s);a.push(new Promise(((t,e)=>{fetch(o).then((t=>t.json())).then((e=>{let a=e.sentences[0].trans;a&&i.val(a),t(a)})).catch((t=>e(t)))})))})),Promise.all(a).then((t=>{i.removeClass("spinner")})).catch((t=>{console.log(t)}))})),t(".tbds-translate-title-n-attributes").on("click",(function(){let e=t(this).closest(".tbds-product-row");t(this).find("i").addClass("spinner");let i=[];e.find(".tbds-import-data-title, .tbds-attributes-tab input").each((function(e){let a=t(this),s=a.val(),o=_(s);i.push(new Promise(((t,e)=>{fetch(o).then((t=>t.json())).then((e=>{let i=e.sentences[0].trans;i&&a.val(i),t(i)})).catch((t=>e(t)))})))})),Promise.all(i).then((i=>{e.find(".tbds-attributes-button-save:not(.vichinads-attributes-button-save-loading)").map((function(){t(this).addClass("vichinads-attributes-button-save-loading")})),e.find(".vichinads-attributes-button-save-loading").length&&e.find(".vichinads-attributes-button-save-loading").eq(0).trigger("click"),e.find(".spinner").removeClass("spinner")})).catch((t=>{console.log(t)}))})),t(".tbds-description-tab-menu").on("click",(function(){t(`.tbds-description-tab[data-tab="${t(this).data("tab")}"]`).find(".switch-tmce").click()})),t(".tbds-gallery-tab-menu").on("click",(function(){let e=t(this).closest(".tbds-accordion"),i=e.find(".tbds-variations-tab"),a=e.find(".tbds-selected-variation-count"),s=e.find(".tbds-product-gallery");a.length>0&&i.hasClass("tbds-variations-tab-loaded")&&(parseInt(a.html())>0?s.addClass("tbds-allow-set-variation-image"):s.removeClass("tbds-allow-set-variation-image"))})),t(".tbds-set-variation-image").on("click",(function(e){e.stopPropagation();let i=t(this),a=i.closest(".tbds-accordion").find(".tbds-product-variation-row").not(".tbds-variation-filter-inactive"),s=i.closest(".tbds-product-gallery-item").find(".tbds-product-gallery-image").data("image_src");s&&a.length>0&&(a.map((function(){let e=t(this);if(e.find(".tbds-variation-enable").prop("checked")){let t=e.find(".tbds-variation-image"),i=t.find('input[type="hidden"]');t.find(".tbds-import-data-variation-image").attr("src",s).attr("image_src",s),i.val()&&i.val(s)}})),villatheme_admin_show_message("Image is set for selected variations","success","",!1,2e3))})),t("body").on("click",".tbds-attributes-attribute-remove",(function(){let e=t(this);e.closest(".tbds-attributes-attribute-row").addClass("tbds-attributes-attribute-removing");let i=t(".tbds-modal-popup-container"),a=t(".tbds-modal-popup-select-attribute");a.html(e.closest(".tbds-attributes-attribute-row").find(".tbds-attributes-attribute-values").html()),a.find(".tbds-attributes-attribute-value").addClass("vi-ui").addClass("button").addClass("mini"),i.attr("class","tbds-modal-popup-container tbds-modal-popup-container-remove-attribute"),u(),1===a.find(".tbds-attributes-attribute-value").length&&a.find(".tbds-attributes-attribute-value").eq(0).click()})).on("click",".tbds-modal-popup-select-attribute .tbds-attributes-attribute-value",(function(){let i=t(this),a=t(".tbds-saving-overlay"),s=t(".tbds-attributes-attribute-removing"),o=s.closest(".tbds-accordion"),d=o.find(".tbds-product-tab").data("tab");a.removeClass("tbds-hidden");let n={};e(s.find("input").serialize(),n),t.ajax({url:tbdsParams.ajaxUrl,type:"POST",dataType:"JSON",data:{action:"tbds_remove_attribute",_ajax_nonce:tbdsParams.security,attribute_slug:s.find(".tbds-attributes-attribute-slug").data("attribute_slug"),attribute_value:i.data("attribute_value"),form_data:n,product_index:d.substring(11)},success:function(e){"success"===e.status?(o.find(".tbds-attributes-attribute-row").length>1?(s.remove(),o.find(".tbds-variations-tab").removeClass("tbds-variations-tab-loaded")):(o.find(".tbds-attributes-tab-menu").remove(),o.find(".tbds-attributes-tab").remove(),o.find(".tbds-variations-tab-menu").remove(),o.find(".tbds-variations-tab").remove(),o.find(".tabular.menu .item").eq(0).addClass("active"),o.find(".tbds-product-tab").addClass("active")),e.html&&t(e.html).insertAfter(o.find(".tbds-import-data-sku-status-visibility")).find(".vi-ui.dropdown").viDropdown({fullTextSearch:!0,forceSelection:!1,selectOnKeydown:!1}),villatheme_admin_show_message(e.message,e.status,"",!1,2e3)):villatheme_admin_show_message(e.message,e.status,"",!1,5e3)},error:function(t){console.log(t),villatheme_admin_show_message("An error occurs","error","",!1,5e3)},complete:function(){a.addClass("tbds-hidden"),t(".tbds-attributes-attribute-editing").removeClass("tbds-attributes-attribute-editing"),t(".tbds-overlay").click()}})})),t(".tbds-accordion-bulk-item-check").on("click",(function(e){let i=t(this),a=!1;if(e.stopPropagation(),i.prop("checked"))a=!0;else{let e=t(".tbds-accordion-bulk-item-check");if(e.length>0)for(let t=0;t<e.length;t++)if(e.eq(t).prop("checked")){a=!0;break}}a?t(".tbds-accordion-bulk-actions-container").fadeIn(200):(t(".tbds-accordion-bulk-actions-container").fadeOut(200),t(".tbds-accordion-bulk-actions").viDropdown("clear"))})),t(".tbds-accordion-bulk-item-check-all").on("click",(function(e){let i=t(this),a=t(".tbds-accordion-bulk-item-check");i.prop("checked")?a.length>0&&(t(".tbds-accordion-bulk-actions-container").fadeIn(200),a.prop("checked",!0).trigger("change")):(t(".tbds-accordion-bulk-actions-container").fadeOut(200),t(".tbds-accordion-bulk-actions").viDropdown("clear"),a.prop("checked",!1).trigger("change"))})),t('select[name="tbds_bulk_actions"]').on("change",(function(){let e=t(this).val(),i=t(".tbds-accordion-bulk-item-check");if(i.length>0&&""!==e){switch(e){case"set_status_publish":case"set_status_pending":case"set_status_draft":let a=e.replace("set_status_","");i.map((function(){let e=t(this);if(e.prop("checked")){let t=e.closest(".tbds-accordion").find(".tbds-import-data-status");t.length>0&&t.find("select").val(a).trigger("change")}}));break;case"set_visibility_visible":case"set_visibility_catalog":case"set_visibility_search":case"set_visibility_hidden":let s=e.replace("set_visibility_","");i.map((function(){let e=t(this);if(e.prop("checked")){let t=e.closest(".tbds-accordion").find(".tbds-import-data-catalog-visibility");t.length>0&&t.find("select").val(s).trigger("change")}}));break;case"set_tags":case"set_categories":let o=e.replace("set_","");t(".tbds-modal-popup-container").attr("class",`tbds-modal-popup-container tbds-modal-popup-container-set-${o}`),u();break;case"import":confirm(tbdsParams.i18n_bulk_import_product_confirm)&&i.map((function(){let e=t(this);if(e.prop("checked")){e.closest(".tbds-accordion").find(".tbds-button-import").not(".tbds-hidden").click()}}));break;case"remove":confirm(tbdsParams.i18n_bulk_remove_product_confirm)&&(b=!0,i.map((function(){let e=t(this);if(e.prop("checked")){e.closest(".tbds-accordion").find(".tbds-button-remove").click()}})),b=!1)}t(".tbds-accordion-bulk-actions").viDropdown("clear")}})),t("body").on("click",".tbds-set-categories-button-set",(function(){let e=t(".tbds-accordion-bulk-item-check"),i=t('select[name="tbds_bulk_set_categories"]').val();e.map((function(){let e=t(this);if(e.prop("checked")){let t=e.closest(".tbds-accordion").find(".tbds-import-data-categories");t.length>0&&t.viDropdown("set exactly",i)}})),p()})).on("click",".tbds-set-categories-button-add",(function(){let e=t(".tbds-accordion-bulk-item-check"),i=t('select[name="tbds_bulk_set_categories"]').val();i.length>0&&e.map((function(){let e=t(this);if(e.prop("checked")){let t=e.closest(".tbds-accordion").find(".tbds-import-data-categories");t.length>0&&t.viDropdown("set exactly",[...new Set(i.concat(t.viDropdown("get values")))])}})),p()})).on("click",".tbds-set-categories-button-cancel",(function(){p()})).on("click",".tbds-set-tags-button-set",(function(){let e=t(".tbds-accordion-bulk-item-check"),i=t('select[name="tbds_bulk_set_tags"]').val();e.map((function(){let e=t(this);if(e.prop("checked")){let t=e.closest(".tbds-accordion").find(".tbds-import-data-tags");t.length>0&&t.viDropdown("set exactly",i)}})),p()})).on("click",".tbds-set-tags-button-add",(function(){let e=t(".tbds-accordion-bulk-item-check"),i=t('select[name="tbds_bulk_set_tags"]').val();i.length>0&&e.map((function(){let e=t(this);if(e.prop("checked")){let t=e.closest(".tbds-accordion").find(".tbds-import-data-tags");t.length>0&&t.viDropdown("set exactly",[...new Set(i.concat(t.viDropdown("get values")))])}})),p()})).on("click",".tbds-set-tags-button-cancel",(function(){p()})).on("click",".tbds-modal-popup-set-categories-clear",(function(){t(this).parent().find(".tbds-modal-popup-set-categories-select").viDropdown("clear")})).on("click",".tbds-modal-popup-set-tags-clear",(function(){t(this).parent().find(".tbds-modal-popup-set-tags-select").viDropdown("clear")})),t(".search-product").select2({width:"100%",closeOnSelect:!0,allowClear:!0,placeholder:"Please enter product title to search",ajax:{url:`admin-ajax.php?action=tbds_search_product&exclude_taobao_products=1&_ajax_nonce=${tbdsParams.security}`,dataType:"json",type:"GET",quietMillis:50,delay:250,data:function(e){return{keyword:e.term,p_id:t(this).closest("td").data("id")}},processResults:function(t){return{results:t}}},escapeMarkup:function(t){return t},minimumInputLength:1});const _=t=>`https://translate.googleapis.com/translate_a/single?client=gtx&sl=zh-CN&tl=${tbdsParams.transCode}&hl=en-US&dt=t&dt=bd&dj=1&source=input&q=${t}`;t(".tbds-title-translate-btn").on("click",(function(){let e=t(this).find("i"),i=t(this).parent().parent().find(".tbds-import-data-title"),a=i.val(),s=_(a);e.addClass("spinner"),fetch(s).then((t=>t.json())).then((t=>{let a=t.sentences[0].trans;a&&i.val(a),e.removeClass("spinner")}))}))}));